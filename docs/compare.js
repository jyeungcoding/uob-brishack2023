const frame = {
    "score": 0.9998754262924194,
    "keypoints": [
        {
            "x": 440.8597549794458,
            "y": 338.8437966387325,
            "z": -707406.0323943475,
            "score": 0.9975403196580902,
            "name": "nose"
        },
        {
            "x": 460.8565448807353,
            "y": 303.9807734086734,
            "z": -684695.3132532244,
            "score": 0.9976131545116044,
            "name": "left_eye_inner"
        },
        {
            "x": 473.03752338219465,
            "y": 305.9497313002621,
            "z": -684522.3887892778,
            "score": 0.9966332689470407,
            "name": "left_eye"
        },
        {
            "x": 486.8448599539375,
            "y": 307.5213257167196,
            "z": -684883.7613694125,
            "score": 0.9971693689040353,
            "name": "left_eye_outer"
        },
        {
            "x": 423.4855164320166,
            "y": 295.4535816840807,
            "z": -695844.2376837153,
            "score": 0.997647748546018,
            "name": "right_eye_inner"
        },
        {
            "x": 406.4540839665449,
            "y": 291.85094295383385,
            "z": -696285.1520754516,
            "score": 0.9969663785147498,
            "name": "right_eye"
        },
        {
            "x": 390.51330458079826,
            "y": 289.1536127403922,
            "z": -696812.0086269861,
            "score": 0.9975971568168186,
            "name": "right_eye_outer"
        },
        {
            "x": 487.7872933009347,
            "y": 317.068433715215,
            "z": -456561.6086546864,
            "score": 0.9971299709251383,
            "name": "left_ear"
        },
        {
            "x": 351.4282665961121,
            "y": 300.21647471651954,
            "z": -516566.27749490715,
            "score": 0.997441652207884,
            "name": "right_ear"
        },
        {
            "x": 456.6880627066359,
            "y": 381.9430403293307,
            "z": -612851.0737210877,
            "score": 0.9973485268631561,
            "name": "mouth_left"
        },
        {
            "x": 404.39974911570033,
            "y": 373.4188178408871,
            "z": -628836.0075497419,
            "score": 0.9978515180623884,
            "name": "mouth_right"
        },
        {
            "x": 557.8237357894222,
            "y": 484.54938542620835,
            "z": -274860.038078422,
            "score": 0.9869283593225536,
            "name": "left_shoulder"
        },
        {
            "x": 215.91182449056734,
            "y": 472.0670419187557,
            "z": -315939.95569570485,
            "score": 0.9880935252571778,
            "name": "right_shoulder"
        },
        {
            "x": 619.1461708062624,
            "y": 657.4785861451392,
            "z": -115378.69150449097,
            "score": 0.22462208357832142,
            "name": "left_elbow"
        },
        {
            "x": 125.26998021167644,
            "y": 660.7262416437138,
            "z": -190179.33061556623,
            "score": 0.3623767165964414,
            "name": "right_elbow"
        },
        {
            "x": 610.3907045824878,
            "y": 810.6092142813081,
            "z": -100674.92007431723,
            "score": 0.049575151891920057,
            "name": "left_wrist"
        },
        {
            "x": 115.51110319558674,
            "y": 819.7126622867257,
            "z": -255320.53057741953,
            "score": 0.10890753969103115,
            "name": "right_wrist"
        },
        {
            "x": 618.0559319047982,
            "y": 863.3418649891498,
            "z": -100130.0230943845,
            "score": 0.05888441299086651,
            "name": "left_pinky"
        },
        {
            "x": 100.33922006606753,
            "y": 871.3403965782003,
            "z": -278282.1620999634,
            "score": 0.1464932911099465,
            "name": "right_pinky"
        },
        {
            "x": 602.9933011109124,
            "y": 857.0571497168207,
            "z": -143010.19798230304,
            "score": 0.08928432391320447,
            "name": "left_index"
        },
        {
            "x": 113.57558527087181,
            "y": 865.9685019002001,
            "z": -315538.5183254973,
            "score": 0.21062123026940235,
            "name": "right_index"
        },
        {
            "x": 593.8718617844385,
            "y": 836.9761828639644,
            "z": -116504.99975728581,
            "score": 0.10292865351737625,
            "name": "left_thumb"
        },
        {
            "x": 126.76978456646083,
            "y": 845.6768371561388,
            "z": -275139.08841397596,
            "score": 0.21692325437621815,
            "name": "right_thumb"
        },
        {
            "x": 488.9217563561541,
            "y": 915.8874196466496,
            "z": -20006.253598321993,
            "score": 0.0006882926640157034,
            "name": "left_hip"
        },
        {
            "x": 269.8837679333626,
            "y": 908.6784668517812,
            "z": 20940.76658366006,
            "score": 0.0006923631687701039,
            "name": "right_hip"
        },
        {
            "x": 465.6379979567723,
            "y": 1257.9712696436673,
            "z": -5437.9350931016825,
            "score": 0.0037710349913956656,
            "name": "left_knee"
        },
        {
            "x": 246.65674293757547,
            "y": 1245.4351867678624,
            "z": 32346.56063176616,
            "score": 0.003028288058707438,
            "name": "right_knee"
        },
        {
            "x": 449.58808282843256,
            "y": 1579.6523770493402,
            "z": 316301.8457256285,
            "score": 0.00024856934128733105,
            "name": "left_ankle"
        },
        {
            "x": 241.83995223192863,
            "y": 1567.2351847427817,
            "z": 231034.26301100373,
            "score": 0.00025708646562627366,
            "name": "right_ankle"
        },
        {
            "x": 449.4674101852253,
            "y": 1626.4134679822835,
            "z": 344799.1415653202,
            "score": 0.00027459140342926073,
            "name": "left_heel"
        },
        {
            "x": 239.1609100074947,
            "y": 1610.3817016838082,
            "z": 245896.73219534184,
            "score": 0.000678307542577423,
            "name": "right_heel"
        },
        {
            "x": 424.1501445878987,
            "y": 1685.7036152036296,
            "z": 184526.91187640073,
            "score": 0.00024820479571221066,
            "name": "left_foot_index"
        },
        {
            "x": 272.13881359370754,
            "y": 1678.6792339580459,
            "z": 16713.152768642947,
            "score": 0.0003807368969239572,
            "name": "right_foot_index"
        }
    ],
    "keypoints3D": [
        {
            "x": 0.061644310450861946,
            "y": -0.5461446649784755,
            "z": -0.3293023805264617,
            "score": 0.997927365221679,
            "name": "nose"
        },
        {
            "x": 0.08501885607906065,
            "y": -0.5858327811240523,
            "z": -0.3193352212093456,
            "score": 0.9978010976964026,
            "name": "left_eye_inner"
        },
        {
            "x": 0.08417354417362571,
            "y": -0.5848599376176132,
            "z": -0.31915843882596046,
            "score": 0.9963996844906923,
            "name": "left_eye"
        },
        {
            "x": 0.08423778174587562,
            "y": -0.5840601636990205,
            "z": -0.3185722907319466,
            "score": 0.9974859023176933,
            "name": "left_eye_outer"
        },
        {
            "x": 0.05179043036506325,
            "y": -0.593094532890087,
            "z": -0.32423189452666146,
            "score": 0.998200326787463,
            "name": "right_eye_inner"
        },
        {
            "x": 0.050791036325826606,
            "y": -0.5933080174562058,
            "z": -0.32538467493952483,
            "score": 0.9972573358010453,
            "name": "right_eye"
        },
        {
            "x": 0.05085530353977481,
            "y": -0.5915668912155719,
            "z": -0.3241571083011012,
            "score": 0.9982829530524654,
            "name": "right_eye_outer"
        },
        {
            "x": 0.12300510067482097,
            "y": -0.583542281595402,
            "z": -0.21920216146369034,
            "score": 0.9966871051308043,
            "name": "left_ear"
        },
        {
            "x": -0.020347247985139937,
            "y": -0.6126209085441422,
            "z": -0.23008339040232317,
            "score": 0.9976653483373795,
            "name": "right_ear"
        },
        {
            "x": 0.06962582423138251,
            "y": -0.5204391970543167,
            "z": -0.28456820598421273,
            "score": 0.9980005335857207,
            "name": "mouth_left"
        },
        {
            "x": 0.028483309432278708,
            "y": -0.5289163455810261,
            "z": -0.28713421852198906,
            "score": 0.9985659455944436,
            "name": "mouth_right"
        },
        {
            "x": 0.18427891516099007,
            "y": -0.41521553332589645,
            "z": -0.13445767466631606,
            "score": 0.9923768241401025,
            "name": "left_shoulder"
        },
        {
            "x": -0.14084502213114444,
            "y": -0.4290809969535927,
            "z": -0.14349691042901885,
            "score": 0.9942166836964607,
            "name": "right_shoulder"
        },
        {
            "x": 0.24344412179975225,
            "y": -0.2504273231234455,
            "z": -0.1279419686027868,
            "score": 0.29383410082666866,
            "name": "left_elbow"
        },
        {
            "x": -0.2327109641329375,
            "y": -0.2754657075174672,
            "z": -0.08932097598238724,
            "score": 0.36920621422361954,
            "name": "right_elbow"
        },
        {
            "x": 0.2145075048804126,
            "y": -0.09750455288879403,
            "z": -0.16277061399649742,
            "score": 0.04572203441258101,
            "name": "left_wrist"
        },
        {
            "x": -0.27043843277533913,
            "y": -0.11890096157442026,
            "z": -0.13711401780521124,
            "score": 0.056921570239769806,
            "name": "right_wrist"
        },
        {
            "x": 0.22786875559209166,
            "y": -0.05415810744805909,
            "z": -0.1732462013334857,
            "score": 0.04628821716692531,
            "name": "left_pinky"
        },
        {
            "x": -0.2709135278350157,
            "y": -0.08662205976846375,
            "z": -0.16020521813929767,
            "score": 0.07600480839099982,
            "name": "right_pinky"
        },
        {
            "x": 0.21426210913711033,
            "y": -0.05789313595154126,
            "z": -0.18211345792037678,
            "score": 0.06917684292900077,
            "name": "left_index"
        },
        {
            "x": -0.2524266100683377,
            "y": -0.07728071837504441,
            "z": -0.17982467629581883,
            "score": 0.11406847978943054,
            "name": "right_index"
        },
        {
            "x": 0.20858029907827708,
            "y": -0.08921504839237998,
            "z": -0.1779589504073351,
            "score": 0.0809597860109953,
            "name": "left_thumb"
        },
        {
            "x": -0.2530728762373483,
            "y": -0.10429340976093873,
            "z": -0.14631928751430712,
            "score": 0.11646842045516258,
            "name": "right_thumb"
        },
        {
            "x": 0.09540765667135166,
            "y": -0.010099309810045726,
            "z": -0.003550677314070789,
            "score": 0.0005457966178992945,
            "name": "left_hip"
        },
        {
            "x": -0.09224643324645602,
            "y": -0.004942818578885122,
            "z": 0.004794997396332845,
            "score": 0.00046488524858077885,
            "name": "right_hip"
        },
        {
            "x": 0.14034929897432694,
            "y": -0.14845403429534348,
            "z": -0.15917019508145164,
            "score": 0.003414663897961009,
            "name": "left_knee"
        },
        {
            "x": -0.1406292839236833,
            "y": -0.22893748377554354,
            "z": -0.13684576295213582,
            "score": 0.002122033974823562,
            "name": "right_knee"
        },
        {
            "x": 0.06212474680973928,
            "y": 0.19530871706687852,
            "z": 0.11833076870297403,
            "score": 0.0002531054487061393,
            "name": "left_ankle"
        },
        {
            "x": -0.05392290537404793,
            "y": 0.1687936844348937,
            "z": -0.05252621077198797,
            "score": 0.0002169445542881491,
            "name": "right_ankle"
        },
        {
            "x": 0.04068381986264106,
            "y": 0.21722991943262013,
            "z": 0.15731904002230698,
            "score": 0.00027581662336565056,
            "name": "left_heel"
        },
        {
            "x": -0.0601986660475227,
            "y": 0.20034278191502305,
            "z": 0.017170609445497795,
            "score": 0.0005994852907237288,
            "name": "right_heel"
        },
        {
            "x": 0.06949031658172862,
            "y": -0.07565247304002558,
            "z": -0.07734998407018438,
            "score": 0.0002622213211886238,
            "name": "left_foot_index"
        },
        {
            "x": -0.07800970095402514,
            "y": -0.09361552946788329,
            "z": -0.2613474992344635,
            "score": 0.0003514064359350281,
            "name": "right_foot_index"
        }
    ]
}

class ComparePositions {
    constructor() {
        this.joints = {
            left_wrist: {A: 11, B: 13, C: 15, acc: null},
            right_wrist:{A: 12, B: 14, C: 16, acc: null}, 
            left_elbow: {A: 13, B: 11, C: 23, acc: null},
            right_elbow:{A: 14, B: 12, C: 24, acc: null},
            left_knee: {A: 24, B: 23, C: 25, acc: null}, 
            right_knee: {A: 23, B: 24, C: 26, acc: null}, 
            left_ankle: {A: 23, B: 25, C: 27, acc: null}, 
            right_ankle: {A: 24, B: 26, C: 28, acc: null}
        }
        this.jointsKeys = Object.keys(this.joints);
    }

    getAngle(pointA, pointB, pointC) {
        let BA = [
            pointA.x - pointB.x,
            pointA.y - pointB.y,
            pointA.z - pointB.z
        ];
        let BC = [
            pointC.x - pointB.x,
            pointC.y - pointB.y,
            pointC.z - pointB.z
        ];

        let dot = BA[0] * BC[0] + BA[1] * BC[1] + BA[2] * BC[2];
        let absBA = Math.sqrt(BA[0] ** 2 + BA[1] ** 2 + BA[2] ** 2);
        let absBC = Math.sqrt(BA[0] ** 2 + BA[1] ** 2 + BA[2] ** 2);
        return Math.acos(dot / (absBA * absBC));
    }

    next(baseFrame, userFrame) {
        for (let key in this.joints) {
            let baseAngle = this.getAngle(
                baseFrame.keypoints3D[this.joints[key].A], 
                baseFrame.keypoints3D[this.joints[key].B], 
                baseFrame.keypoints3D[this.joints[key].C]
            );
            let userAngle = this.getAngle(
                userFrame.keypoints3D[this.joints[key].A], 
                userFrame.keypoints3D[this.joints[key].B], 
                userFrame.keypoints3D[this.joints[key].C]
            );
            this.joints[key].acc = baseAngle - userAngle;
        }
        return this.accuracy;
    }
}

let comp = new ComparePositions();
let output = comp.next(frame, frame);
console.log(output);

